document.addEventListener("DOMContentLoaded", function () {
    setupQuiz();
    displayWelcomeMessage();
});

let currentQuestionIndex = 0;

const questions = [
    { image: "question1.png", answer: "ozil" },
    { image: "question2.png", answer: "jinping" },
    { image: "question3.png", answer: "djokovic" },
    { image: "question4.png", answer: "brady" },
    { image: "question6.png", answer: "sakho" },
    { image: "question7.png", answer: "singe" },
    { image: "question5.png", answer: "hitler" },
    { image: "question8.png", answer: "georges" }
];

function setupQuiz() {
    const answerInput = document.getElementById("answer");
    const questionTitle = document.querySelector(".question h2");
    const questionImage = document.querySelector(".question img");

    if (!answerInput || !questionTitle || !questionImage) {
        console.error("Missing elements needed for quiz setup");
        return;
    }

    answerInput.focus();

    // Remove previous listeners if any, then add the keydown listener
    answerInput.onkeydown = function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            checkAnswer(this, questionTitle, questionImage);
        }
    };

    loadQuestion(questionTitle, questionImage);
}

function loadQuestion(titleElement, imageElement) {
    const current = questions[currentQuestionIndex];
    const questionNumber = currentQuestionIndex + 1;
    titleElement.textContent = `Who is this?`;
    imageElement.src = `../questions/${current.image}`;
    imageElement.alt = `Question ${questionNumber}`;
}

function checkAnswer(inputElement, titleElement, imageElement) {
    const userAnswer = inputElement.value.trim().toLowerCase();

    if (currentQuestionIndex >= questions.length) return;

    const correctAnswer = questions[currentQuestionIndex].answer.toLowerCase();
    // Use word boundaries to match the word, case insensitive
    const pattern = new RegExp(`\\b${correctAnswer}\\b`, "i");

    if (pattern.test(userAnswer)) {
        currentQuestionIndex++;

        if (currentQuestionIndex < questions.length) {
            inputElement.value = "";
            loadQuestion(titleElement, imageElement);
        } else {
            lockInput(inputElement, "You found all the correct answers!");
        }
    } else {
        // Clear input if incorrect, no message shown
        inputElement.value = "";
    }
}

function lockInput(inputElement, message) {
    inputElement.disabled = true;
    inputElement.value = message;
    inputElement.style.color = "green";
    inputElement.style.fontWeight = "bold";
}

function displayWelcomeMessage() {
    const username = getUsername();
    const welcome = document.querySelector(".welcome");
    if (welcome) {
        welcome.textContent = `Welcome, ${username}!`;
    }
}

function getUsername() {
    return localStorage.getItem("username") || "Player";
}

function updateLeaderboard(players) {
    const list = document.getElementById("leaderboard-list");
    if (!list) return;

    list.innerHTML = "";

    players.sort((a, b) => b.score - a.score);

    players.forEach(player => {
        const li = document.createElement("li");
        li.textContent = `${player.name} â€“ ${player.score} pts`;
        list.appendChild(li);
    });
}

// Initialize leaderboard with the user from localStorage
document.addEventListener("DOMContentLoaded", () => {
    const username = getUsername();

    const players = [
        { name: username, score: 0 }
    ];

    updateLeaderboard(players);
});
